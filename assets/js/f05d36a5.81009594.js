"use strict";(self.webpackChunkrts_docs=self.webpackChunkrts_docs||[]).push([["2548"],{86497(e,n,i){i.r(n),i.d(n,{metadata:()=>t,default:()=>d,frontMatter:()=>s,contentTitle:()=>o,toc:()=>c,assets:()=>l});var t=JSON.parse('{"id":"hpc/containers/intro","title":"Custom Applications with Containers","description":"What is Singularity?","source":"@site/docs/hpc/07_containers/01_intro.md","sourceDirName":"hpc/07_containers","slug":"/hpc/containers/intro","permalink":"/docs/hpc/containers/intro","draft":false,"unlisted":false,"editUrl":"https://github.com/NYU-RTS/rts-docs/blob/main/docs/hpc/07_containers/01_intro.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"hpcSidebar","previous":{"title":"SQLite: Handling Large Structured Data","permalink":"/docs/hpc/tools_and_software/sqlite_handling_large_structured_data"},"next":{"title":"Using Containers on HPC","permalink":"/docs/hpc/containers/containers"}}'),a=i(62615),r=i(30416);let s={},o="Custom Applications with Containers",l={},c=[{value:"What is Singularity?",id:"what-is-singularity",level:2},{value:"Why do we use Singularity",id:"why-do-we-use-singularity",level:2},{value:"How to run a singularity container",id:"how-to-run-a-singularity-container",level:2},{value:"1. pull a image from Singularity hub or Docker hub",id:"1-pull-a-image-from-singularity-hub-or-docker-hub",level:3},{value:"2. build the image",id:"2-build-the-image",level:3},{value:"3. run container",id:"3-run-container",level:3},{value:"Enter Container",id:"enter-container",level:4},{value:"Run commands outside the container",id:"run-commands-outside-the-container",level:4},{value:"How to Create a Singularity Container",id:"how-to-create-a-singularity-container",level:2},{value:"Singularity vs Docker",id:"singularity-vs-docker",level:2}];function u(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"custom-applications-with-containers",children:"Custom Applications with Containers"})}),"\n",(0,a.jsx)(n.h2,{id:"what-is-singularity",children:"What is Singularity?"}),"\n",(0,a.jsxs)(n.p,{children:["Singularity is a container based Linux kernel workspace that works just like Docker.  You can run pre-built programs in containers without having to worry about the pre-install environment.  You can even run Docker containers with Singularity.  Please see the ",(0,a.jsx)(n.a,{href:"https://docs.sylabs.io/guides/4.3/user-guide/singularity_and_docker.html",children:"Singularity and Docker"})," documentation by Syslabs for details about all the ways Singularity supports Docker.  For a detailed introduction on Singularity, visit their ",(0,a.jsx)(n.a,{href:"https://apptainer.org/documentation/",children:"official site"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"The Singularity we use is actually an alias for the name Apptainer.  When we transition to the new Torch cluster you will only see reference to Apptainer.  The reason for this is that there were two container projects with the name Singularity.  The original free and open-source (FOSS) project and a closed-source corporate fork.  The FOSS version has renamed itself to Apptainer to avoid confusion and this is the version we use."}),"\n",(0,a.jsx)(n.h2,{id:"why-do-we-use-singularity",children:"Why do we use Singularity"}),"\n",(0,a.jsx)(n.p,{children:"There are multiple reasons to use Singularity on the HPC clusters:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Security"}),": Singularity provides a layer of security as it does not require any root access on our clusters. This makes it safer against malware and bad scripts that might jeopardize the outer system. Thus we only support Singularity on our clusters (there are not other options such as Kubernetes or Docker on our clusters right now)."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Containerization"}),": Singularity will run all your images (packaged and pre-built programs) inside of its containers, each container works like a small vm. They contain all the required environment and files of a single Linux kernel and you don't have to worry about any pre-installation nonsense."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Inter-connectivity"}),": Containers are able to talk to each other, as well as the home system, so while each container has its own small space, they are still a part of a big interconnected structure. Thus enabling you to connect your programs."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Accessibility"}),": Probably the most important feature of all, Singularity allows you to run your program in 2 to 3 simple steps, as shown below."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"how-to-run-a-singularity-container",children:"How to run a singularity container"}),"\n",(0,a.jsx)(n.p,{children:"There are 3 steps to run a Singularity container on our clusters:"}),"\n",(0,a.jsx)(n.h3,{id:"1-pull-a-image-from-singularity-hub-or-docker-hub",children:"1. pull a image from Singularity hub or Docker hub"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"$ singularity pull <image name>\n# image name can be for example shub://vsoch/hello-world or docker://godlovedc/lolcow\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"singularity1",src:i(86169).A+"",width:"1280",height:"142"})}),"\n",(0,a.jsx)(n.h3,{id:"2-build-the-image",children:"2. build the image"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"$ singularity build <a name of your choosing>.simg:rw <image name>\n# the image name can be a local image or an image from a hub\n"})}),"\n",(0,a.jsxs)(n.p,{children:["We add the ",(0,a.jsx)(n.code,{children:":rw"})," tag at the end of the ",(0,a.jsx)(n.code,{children:".simg"}),' file to explicitly give it "read and write" permissions while building.']}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"singularity2",src:i(37986).A+"",width:"1280",height:"224"})}),"\n",(0,a.jsx)(n.p,{children:"You can now run your container using the built image."}),"\n",(0,a.jsx)(n.h3,{id:"3-run-container",children:"3. run container"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"# this is one way of running a container\n$ singularity run <image name>.simg:ro\n# this is another way to run a container\n$ ./<image name>.simg:ro\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Unlike in the build phase, we add the ",(0,a.jsx)(n.code,{children:":ro"}),' tag which means "read only" - as we are now just executing the image, not building it, and thus do not need it to be written.']}),"\n",(0,a.jsx)(n.admonition,{type:"warning",children:(0,a.jsx)(n.p,{children:"Write access causes the Singularity image to be locked and it can become inaccessible while it is in read/write mode, so read only mode is best for executing commands."})}),"\n",(0,a.jsx)(n.p,{children:"running this would yield a menu for output:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"singularity3",src:i(59115).A+"",width:"1280",height:"365"})}),"\n",(0,a.jsx)(n.h4,{id:"enter-container",children:"Enter Container"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"singularity shell <image name>.simg:ro\n# after this step, you will be going into the container and start your programming\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"singularity4",src:i(13204).A+"",width:"1280",height:"366"})}),"\n",(0,a.jsxs)(n.admonition,{type:"tip",children:[(0,a.jsx)(n.h4,{id:"run-commands-outside-the-container",children:"Run commands outside the container"}),(0,a.jsx)(n.p,{children:"You can run commands for the container using exec arguments without actually going into the container"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"$ singularity exec <image name>.simg:ro <commands>\n# adding commands to the back will return the display result of these commands in the container without actually going into the container\n"})}),(0,a.jsx)(n.p,{children:"Example:"}),(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"singularity5",src:i(34333).A+"",width:"1280",height:"115"})})]}),"\n",(0,a.jsx)(n.p,{children:"That's it! Now you're good to go and can just use these simple steps to run singularity images and run your programs."}),"\n",(0,a.jsxs)(n.p,{children:["For full information and documentation please visit ",(0,a.jsx)(n.a,{href:"https://sylabs.io/docs/",children:"Singularity"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"how-to-create-a-singularity-container",children:"How to Create a Singularity Container"}),"\n",(0,a.jsx)(n.p,{children:"So what if you want to create an image from your container and save it for a rainy day?"}),"\n",(0,a.jsxs)(n.p,{children:["Apptainer documentation has ",(0,a.jsx)(n.a,{href:"https://apptainer.org/docs/user/latest/build_a_container.html",children:"instructions for building containers"})," for your convenience.  Please read through them to create your own Singularity container and package it into an image!"]}),"\n",(0,a.jsxs)(n.p,{children:["Similarly, you can build docker containers using the information from ",(0,a.jsx)(n.a,{href:"https://docs.docker.com/get-started/docker-concepts/building-images/",children:"Docker's documentation"}),". You can then upload them onto docker hub and pull them using Singularity. Singularity supports all docker images!"]}),"\n",(0,a.jsx)(n.h2,{id:"singularity-vs-docker",children:"Singularity vs Docker"}),"\n",(0,a.jsx)(n.p,{children:"Why are there so many mentions of Docker? The reason is that Singularity is essentially the same as Docker and you don't need to relearn Singularity if you already have experience with Docker. Now let's get into some pros and cons between the two programs."}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Docker is more accepted commercially than Singularity. You can download and run Docker on your own computer with any operating system and build containers with ease while Singularity is used in a more academic setting. Singularity only supports Linux operating systems and cannot run on a Windows Linux Kernel (your Windows Ubuntu), so it is much more limited."}),"\n",(0,a.jsx)(n.li,{children:"However, Docker requires root or admin access for the operating system it deploys on, and our clusters do not offer that access to any software that requires this criteria. Thus Docker is not available on the clusters and Singularity is."}),"\n",(0,a.jsx)(n.li,{children:"A silver lining in all of this is that Singularity fully supports Docker images and you can do everything in Docker and push your image to Docker Hub and pull them on the clusters. Thus making sure that you don't need to relearn Singularity all over again and can just use it through the simplest of commands in this wiki."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Good luck with Singularity, and have fun!"})]})}function d(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},86169(e,n,i){i.d(n,{A:()=>t});let t=i.p+"assets/images/singularity1-25aa0987f620a7c3971e961c28006b05.png"},37986(e,n,i){i.d(n,{A:()=>t});let t=i.p+"assets/images/singularity2-3a3ca2dd209f3766478b1bb8da34eed1.png"},59115(e,n,i){i.d(n,{A:()=>t});let t=i.p+"assets/images/singularity3-28a8e48782cd3e10b0414813d0971711.png"},13204(e,n,i){i.d(n,{A:()=>t});let t=i.p+"assets/images/singularity4-fc6d63dbcb7e6c8d3d81220bc1cd8b40.png"},34333(e,n,i){i.d(n,{A:()=>t});let t=i.p+"assets/images/singularity5-8d0e2d09aeae68e1ad42966a1e623782.png"},30416(e,n,i){i.d(n,{R:()=>s,x:()=>o});var t=i(59471);let a={},r=t.createContext(a);function s(e){let n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);
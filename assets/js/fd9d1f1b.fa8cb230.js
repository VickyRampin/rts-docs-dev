"use strict";(self.webpackChunkrts_docs=self.webpackChunkrts_docs||[]).push([["8819"],{55282(e,t,s){s.r(t),s.d(t,{metadata:()=>i,default:()=>d,frontMatter:()=>r,contentTitle:()=>l,toc:()=>c,assets:()=>a});var i=JSON.parse('{"id":"hpc/submitting_jobs/slurm_submitting_jobs","title":"Submitting Jobs on Torch","description":"If you are new to using HPC resources and would like to learn about the principles of using the SLURM scheduler for submitting batch jobs, please refer to this section. This section focuses on the specifics of the Torch cluster and assumes familiarity with the tutorial.","source":"@site/docs/hpc/05_submitting_jobs/01_slurm_submitting_jobs.md","sourceDirName":"hpc/05_submitting_jobs","slug":"/hpc/submitting_jobs/slurm_submitting_jobs","permalink":"/docs/hpc/submitting_jobs/slurm_submitting_jobs","draft":false,"unlisted":false,"editUrl":"https://github.com/NYU-RTS/rts-docs/blob/main/docs/hpc/05_submitting_jobs/01_slurm_submitting_jobs.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"hpcSidebar","previous":{"title":"Working with Datasets","permalink":"/docs/hpc/datasets/working_with_datasets"},"next":{"title":"Slurm: Command reference","permalink":"/docs/hpc/submitting_jobs/slurm_main_commands"}}'),o=s(62615),n=s(30416);let r={},l="Submitting Jobs on Torch",a={},c=[{value:"Partitions",id:"partitions",level:2},{value:"Resource limits and restrictions",id:"resource-limits-and-restrictions",level:2},{value:"Job Submission on Torch",id:"job-submission-on-torch",level:2},{value:"Preemptible jobs on Torch",id:"preemptible-jobs-on-torch",level:2},{value:"Advanced options",id:"advanced-options",level:2},{value:"GPU MPS",id:"gpu-mps",level:3},{value:"RAM disk",id:"ram-disk",level:3},{value:"GPU MPS &amp; RAM Disk in a preemptible job",id:"gpu-mps--ram-disk-in-a-preemptible-job",level:3}];function h(e){let t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,n.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"submitting-jobs-on-torch",children:"Submitting Jobs on Torch"})}),"\n",(0,o.jsx)(t.admonition,{title:"Beginner tutorial available",type:"tip",children:(0,o.jsxs)(t.p,{children:["If you are new to using HPC resources and would like to learn about the principles of using the ",(0,o.jsx)(t.code,{children:"SLURM"})," scheduler for submitting batch jobs, please refer to ",(0,o.jsx)(t.a,{href:"/docs/hpc/tutorial_intro_hpc/scheduler_fundamentals",children:"this section"}),". This section focuses on the specifics of the Torch cluster and assumes familiarity with the tutorial."]})}),"\n",(0,o.jsx)(t.admonition,{title:"Active allocation in the HPC projects portal",type:"warning",children:(0,o.jsxs)(t.p,{children:["An active allocation in the HPC projects portal is needed to submit any jobs on Torch. For more information on how to get one, please refer to ",(0,o.jsx)(t.a,{href:"/docs/hpc/getting_started/hpc_project_management_portal",children:"this section"}),". All job submissions must include the ",(0,o.jsx)(t.code,{children:"--account"})," parameter."]})}),"\n",(0,o.jsx)(t.h2,{id:"partitions",children:"Partitions"}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"SLURM"})," partitions on Torch control stakeholder resource access. No physical nodes are tied to partitions \u2014 instead, equivalent compute resources are allocated via partition ",(0,o.jsx)(t.code,{children:"QoS"}),"(",(0,o.jsx)(t.a,{href:"https://slurm.schedmd.com/qos.html",children:"QualityOfService"}),")."]}),"\n",(0,o.jsx)(t.admonition,{title:"Partitions",type:"tip",children:(0,o.jsx)(t.p,{children:"Do not specify partitions manually, except for preemption which is described later."})}),"\n",(0,o.jsx)(t.h2,{id:"resource-limits-and-restrictions",children:"Resource limits and restrictions"}),"\n",(0,o.jsxs)(t.p,{children:["Jobs within the same partition cannot exceed their assigned resources (",(0,o.jsx)(t.code,{children:"QOSGrpGRES"}),"). User GPU Quotas: Each user has a total GPU quota of 24 GPUs for jobs with wall time < 48 hours (",(0,o.jsx)(t.code,{children:"QOSMaxGRESPerUser"}),")."]}),"\n",(0,o.jsx)(t.p,{children:"Non-stakeholders to temporarily use stakeholder resources (a stakeholder group to temporarily use another group\u2019s resources). Stakeholders retain normal access to their own resources. If non-stakeholders (or other stakeholders) are using them, their jobs may be preempted (canceled) once stakeholders submit new jobs. Public users are allowed to use stakeholder resources only with preemption partitions. Refer to the section below for details on preemptible jobs."}),"\n",(0,o.jsx)(t.h2,{id:"job-submission-on-torch",children:"Job Submission on Torch"}),"\n",(0,o.jsxs)(t.p,{children:["As stated in the tuturial, always only request the compute resources (e.g., GPUs, CPUs, memory) needed for the job. Requesting too many resources can prevent your job from being scheduled within an adequate time. The ",(0,o.jsx)(t.code,{children:"SLURM"})," scheduler will automatically dispatch jobs to all accessible GPU partitions that match resource requests."]}),"\n",(0,o.jsx)(t.admonition,{title:"Low GPU Utilization Policy",type:"danger",children:(0,o.jsx)(t.p,{children:"Jobs with low GPU utilization will be automatically canceled. The exact threshold is TBD, but enforcement will be very aggressive."})}),"\n",(0,o.jsx)(t.h2,{id:"preemptible-jobs-on-torch",children:"Preemptible jobs on Torch"}),"\n",(0,o.jsx)(t.p,{children:'On Torch, users may run "preemptible" jobs on stakeholder resources that their group does not own. This allows the stakeholder resources to be utilized by non-stakeholders which may otherwise be idle. To make the best use of these resources, you are encouraged to adopt checkpoint/restart to allow for resumption of the workload in subsequent jobs.'}),"\n",(0,o.jsx)(t.admonition,{title:"Preemption Policy",type:"warning",children:(0,o.jsx)(t.p,{children:"Jobs become eligible for preemption after 1 hour of runtime. Jobs will not be canceled within the first hour."})}),"\n",(0,o.jsx)(t.p,{children:"The preemption order is:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Stakeholder jobs (highest priority), these can preempt GPU jobs from public users or other stakeholders"}),"\n",(0,o.jsx)(t.li,{children:"GPU jobs can preempt CPU-only jobs running on GPU nodes"}),"\n",(0,o.jsx)(t.li,{children:"Partition Assignment Order"}),"\n",(0,o.jsx)(t.li,{children:"PI stakeholder partitions"}),"\n",(0,o.jsx)(t.li,{children:"School stakeholder partitions"}),"\n",(0,o.jsx)(t.li,{children:"IT public partitions"}),"\n",(0,o.jsx)(t.li,{children:"Preemption partitions\nApplies separately to both GPU types: L40S first, then H200"}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"To allow jobs in both normal and preemption partitions:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'#SBATCH --comment="preemption=yes;requeue=true"\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Jobs in stakeholder partitions will not be canceled, but those in preemption partitions may be. Canceled jobs will be re-queued automatically with ",(0,o.jsx)(t.code,{children:"requeue=true"}),".  To use only preemption partitions:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'#SBATCH --comment="preemption=yes;preemption_partitions_only=yes;requeue=true"\n'})}),"\n",(0,o.jsx)(t.p,{children:"Jobs with preemption partitions only might be allowed to use more resources"}),"\n",(0,o.jsx)(t.h2,{id:"advanced-options",children:"Advanced options"}),"\n",(0,o.jsx)(t.h3,{id:"gpu-mps",children:"GPU MPS"}),"\n",(0,o.jsx)(t.p,{children:"Use GPU Multi-Process Service (MPS) to improve overall GPU utilization, as this allows multiple GPU jobs to share a single GPU concurrently by:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'#SBATCH --comment="gpu_mps=yes"\n'})}),"\n",(0,o.jsx)(t.h3,{id:"ram-disk",children:"RAM disk"}),"\n",(0,o.jsxs)(t.p,{children:["A portion of the RAM available can be mounted as a disk for fast ",(0,o.jsx)(t.code,{children:"I/O"})," operations:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'#SBATCH --comment="ram_disk=1GB"\n'})}),"\n",(0,o.jsx)(t.h3,{id:"gpu-mps--ram-disk-in-a-preemptible-job",children:"GPU MPS & RAM Disk in a preemptible job"}),"\n",(0,o.jsx)(t.p,{children:"Both of these can be combined with preemption as shown:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'#SBATCH --comment="preemption=yes;preemption_partitions_only=yes;requeue=true;gpu_mps=yes;ram_disk=1GB"\n'})})]})}function d(e={}){let{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},30416(e,t,s){s.d(t,{R:()=>r,x:()=>l});var i=s(59471);let o={},n=i.createContext(o);function r(e){let t=i.useContext(n);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(n.Provider,{value:t},e.children)}}}]);
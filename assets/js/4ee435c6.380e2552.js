"use strict";(self.webpackChunkrts_docs=self.webpackChunkrts_docs||[]).push([["9839"],{73174(e,n,s){s.r(n),s.d(n,{metadata:()=>r,default:()=>h,frontMatter:()=>a,contentTitle:()=>t,toc:()=>l,assets:()=>d});var r=JSON.parse('{"id":"hpc/ood/jbrowse_genome_browser","title":"JBrowse Genome Browser in OOD","description":"JBrowse is a web-based genome browser for visualizing genomic features in common file formats, such as variants (VCF), genes (GFF3, BigBed) and gene expression (BigWig), and sequence alignments (BAM, CRAM, and GFF3).","source":"@site/docs/hpc/09_ood/06_jbrowse_genome_browser.mdx","sourceDirName":"hpc/09_ood","slug":"/hpc/ood/jbrowse_genome_browser","permalink":"/docs/hpc/ood/jbrowse_genome_browser","draft":false,"unlisted":false,"editUrl":"https://github.com/NYU-RTS/rts-docs/blob/main/docs/hpc/09_ood/06_jbrowse_genome_browser.mdx","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{},"sidebar":"hpcSidebar","previous":{"title":"Integrative Genomics Viewer (IGV) in OOD","permalink":"/docs/hpc/ood/igv"},"next":{"title":"Jupyter Notebook with Conda/Singularity in OOD","permalink":"/docs/hpc/ood/jupyter_with_conda_singularity"}}'),o=s(62615),i=s(30416);let a={},t="JBrowse Genome Browser in OOD",d={},l=[{value:"Getting started",id:"getting-started",level:2},{value:"1. Place or link all files into one data folder",id:"1-place-or-link-all-files-into-one-data-folder",level:3},{value:"2. Verify data files are in a supported format",id:"2-verify-data-files-are-in-a-supported-format",level:3},{value:"FA",id:"fa",level:4},{value:"GFF3",id:"gff3",level:4},{value:"BED",id:"bed",level:4},{value:"BAM/CRAM",id:"bamcram",level:4},{value:"VCF",id:"vcf",level:4},{value:"3. Create the configuration file, tracks.conf",id:"3-create-the-configuration-file-tracksconf",level:3},{value:"4. Making feature names searchable in JBrowse (Optional)",id:"4-making-feature-names-searchable-in-jbrowse-optional",level:3},{value:"Configuration",id:"configuration",level:2},{value:"JBrowse running in OOD",id:"jbrowse-running-in-ood",level:2}];function c(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"jbrowse-genome-browser-in-ood",children:"JBrowse Genome Browser in OOD"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.a,{href:"https://jbrowse.org/jbrowse1.html",children:"JBrowse"})," is a web-based genome browser for visualizing genomic features in common file formats, such as variants (VCF), genes (GFF3, BigBed) and gene expression (BigWig), and sequence alignments (BAM, CRAM, and GFF3)."]}),"\n",(0,o.jsx)(n.h2,{id:"getting-started",children:"Getting started"}),"\n",(0,o.jsx)(n.h3,{id:"1-place-or-link-all-files-into-one-data-folder",children:"1. Place or link all files into one data folder"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ cd /path/to/data_directory\n$ ls \nalignments.sorted.bam\nalignments.sorted.bam.bai\nexpression.bw\ngenes.gff3     \ngenes.gff3.tbi  \nreference.fa.       \nreference.fa.fai    \ntracks.conf\nvariants.sorted.vcf.gz \nvariants.sorted.vcf.gz.tbi\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Commonly used genomic data sets are available from the ",(0,o.jsx)(n.a,{href:"https://gencore.bio.nyu.edu/explore-the-new-shared-genome-resource/",children:"Shared Genome Resource"}),".  The data is stored in a common location with the following naming convention:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"/scratch/work/cgsb/genomes/Public/<KINGDOM>/<SPECIES>/<SOURCE>/<VERSION>/\n"})}),"\n",(0,o.jsxs)(n.admonition,{type:"tip",children:[(0,o.jsx)(n.p,{children:"There is no need to copy the reference or GFF3 to your data directory.  This would just waste space. You should link the files you'd like to your data directory as shown below:"}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ ln -s /scratch/work/cgsb/genomes/.../reference.fa reference.fa\n$ ln -s /scratch/work/cgsb/genomes/.../reference.fai reference.fai\n$ ln -s /scratch/work/cgsb/genomes/.../genes.gff3 genes.gff3\n$ ln -s /scratch/work/cgsb/genomes/.../genes.gff3.tbi genes.gff3.tbi\n"})})]}),"\n",(0,o.jsx)(n.h3,{id:"2-verify-data-files-are-in-a-supported-format",children:"2. Verify data files are in a supported format"}),"\n",(0,o.jsxs)(n.p,{children:["For the commands listed below, ",(0,o.jsx)(n.code,{children:"bgzip"})," and ",(0,o.jsx)(n.code,{children:"tabix"})," are provided by the ",(0,o.jsx)(n.code,{children:"htslib"})," module. ",(0,o.jsx)(n.code,{children:"samtools"})," and ",(0,o.jsx)(n.code,{children:"bcftools"})," are provided by the module of the same name. (use ",(0,o.jsx)(n.code,{children:"module avail htslib samtools bcftools"})," to list the installed versions)"]}),"\n",(0,o.jsx)(n.h4,{id:"fa",children:"FA"}),"\n",(0,o.jsxs)(n.p,{children:["If the reference and index are not available in the ",(0,o.jsx)(n.a,{href:"https://gencore.bio.nyu.edu/explore-the-new-shared-genome-resource/",children:"Shared Genome Resource"}),", it should be compressed with ",(0,o.jsx)(n.code,{children:"bgzip"})," and indexed with ",(0,o.jsx)(n.code,{children:"samtools faidx"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"bgzip reference.fa\nsamtools faidx reference.fa.gz\n"})}),"\n",(0,o.jsx)(n.h4,{id:"gff3",children:"GFF3"}),"\n",(0,o.jsxs)(n.p,{children:["If the GFF3 is not available in the ",(0,o.jsx)(n.a,{href:"https://gencore.bio.nyu.edu/explore-the-new-shared-genome-resource/",children:"Shared Genome Resource"}),", the file should first be sorted by ",(0,o.jsx)(n.code,{children:"seqid"})," (column 1) and ",(0,o.jsx)(n.code,{children:"start"})," (column 4), compressed with ",(0,o.jsx)(n.code,{children:"bgzip"}),", and indexed with ",(0,o.jsx)(n.code,{children:"tabix"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"awk -F '\\t' 'NF == 9' genes.gff3 | sort -k 1,1 -k 4n,4n | bgzip > genes.sorted.gff3.gz\ntabix -p gff genes.sorted.gff3.gz\n"})}),"\n",(0,o.jsx)(n.p,{children:"The above command generates a GFF3 lacking directives/comments found in the original, but they not necessary for viewing in JBrowse."}),"\n",(0,o.jsx)(n.h4,{id:"bed",children:"BED"}),"\n",(0,o.jsxs)(n.p,{children:["A number of BED file formats can be displayed after sorting by ",(0,o.jsx)(n.code,{children:"chrom"})," (column 1) then ",(0,o.jsx)(n.code,{children:"chromStart"})," (column 2), compressed with ",(0,o.jsx)(n.code,{children:"bgzip"}),", and indexed with ",(0,o.jsx)(n.code,{children:"tabix"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sort -k 1,1 -k 2n,2n peaks.bed | bgzip > peaks.sorted.bed.gz\ntabix -p bed peaks.sorted.bed.gz\n"})}),"\n",(0,o.jsx)(n.h4,{id:"bamcram",children:"BAM/CRAM"}),"\n",(0,o.jsxs)(n.p,{children:["BAM and CRAM files must be sorted with ",(0,o.jsx)(n.code,{children:"samtools sort"})," and indexed with ",(0,o.jsx)(n.code,{children:"samtools index"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"samtools sort -o alignments.sorted.bam my.bam\nsamtools index alignments.sorted.bam\n"})}),"\n",(0,o.jsxs)(n.p,{children:["For large BAM files, use the ",(0,o.jsx)(n.code,{children:"--threads"})," option to set the number of threads for sorting, the ",(0,o.jsx)(n.code,{children:"-m"})," option to specify the amount of memory per thread, and the ",(0,o.jsx)(n.code,{children:"-l"})," option to set compression level for the resulting BAM file."]}),"\n",(0,o.jsx)(n.h4,{id:"vcf",children:"VCF"}),"\n",(0,o.jsxs)(n.p,{children:["VCF files should be sorted with ",(0,o.jsx)(n.code,{children:"bcftools"})," and indexed with ",(0,o.jsx)(n.code,{children:"tabix"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"bcftools sort --output-type=z --output-file=variants.sorted.vcf.gz variants.vcf\ntabix -p vcf variants.sorted.vcf.gz\n"})}),"\n",(0,o.jsxs)(n.p,{children:["For large VCF files (above ~768M), the bcftools ",(0,o.jsx)(n.code,{children:"--max-mem"})," option may be used to allocate extra memory for sorting VCF records, avoiding the use of the file system for an ",(0,o.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/External_sorting#External_merge_sort",children:"external merge sort"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"3-create-the-configuration-file-tracksconf",children:"3. Create the configuration file, tracks.conf"}),"\n",(0,o.jsxs)(n.p,{children:["An example of a ",(0,o.jsx)(n.a,{href:"https://jbrowse.org/docs/minimal.html",children:"minimal configuration"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ini",children:'[GENERAL]\nrefSeqs=reference.fa.gz.fai\n# reference sequence compressed with bgzip & indexed with "samtools faidx"\n## If using Shared Genome Resource where file is uncompressed\n## refSeqs=reference.fa.fai\n\n[tracks.reference]\nurlTemplate=reference.fa.gz\n# file specified as the refSeqs value without the ".fai" suffix\n## If using Shared Genome Resource where file is uncompressed\n## urlTemplate=reference.fa.\n\n[tracks.alignments]\nurlTemplate=alignments.sorted.bam\n# my.sorted.bam.bai (created by "samtools index") is assumed to exist\n## baiUrlTemplate=alignments.sorted.bai\n# custom name if corresponding .bai file isn\'t suffixed with .bam.bai\n\n[tracks.variants]\nurlTemplate=variants.sorted.vcf.gz\n# variants.sorted.vcf.gz.tbi assumed to exist\n\n[tracks.genes]\nurlTemplate=genes.sorted.gff3.gz\n# genes.sorted.gff3.gz.tbi assumed to exist\n## If using Shared Genome Resource where file is uncompressed\n## you must create the tbi index with tabix.\n## urlTemplate=genes.sorted.gff3\n\n[tracks.expression]\nurlTemplate=expression.bw\n\n[tracks.peaks]\nurlTemplate=peaks.bed.gz\n# peaks.bed.gz.tbi assumed to exist\n'})}),"\n",(0,o.jsx)(n.p,{children:"Customizing Tracks:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://jbrowse.org/docs/reference_sequence.html",children:"Reference Sequence Configuration"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://jbrowse.org/docs/alignments.html",children:"Alignment Tracks"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://jbrowse.org/docs/bigwig.html",children:"Wiggle/BigWig Tracks"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://jbrowse.org/docs/variants.html",children:"VCF Tracks"})}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"4-making-feature-names-searchable-in-jbrowse-optional",children:"4. Making feature names searchable in JBrowse (Optional)"}),"\n",(0,o.jsxs)(n.p,{children:["The JBrowse ",(0,o.jsx)(n.code,{children:"generate-names.pl"})," script generates an index of feature names for searching and autocompletion when typed into the JBrowse search box, or the ",(0,o.jsx)(n.code,{children:"View > search for features"})," menu option."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"module load jbrowse/web/1.16.0\ngenerate-names.pl --compress --out .\n"})}),"\n",(0,o.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,o.jsxs)(n.p,{children:["Enter the full path to the directory you created above in the ",(0,o.jsx)(n.code,{children:"Data Folder Path"})," input, add any optional Slurm options and press the ",(0,o.jsx)(n.code,{children:"Launch"})," button."]}),"\n",(0,o.jsx)(n.h2,{id:"jbrowse-running-in-ood",children:"JBrowse running in OOD"}),"\n",(0,o.jsx)(n.p,{children:"After a short pause while your job is in the Torch queue and then starts up, you'll see the JBrowse application."})]})}function h(e={}){let{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},30416(e,n,s){s.d(n,{R:()=>a,x:()=>t});var r=s(59471);let o={},i=r.createContext(o);function a(e){let n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);
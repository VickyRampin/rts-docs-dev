<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-hpc/ood/jupyter_with_conda_singularity" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Jupyter Notebook with Conda/Singularity in OOD | Connecting researchers to computational resources.</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://services.rt.nyu.edu/img/NYU.svg"><meta data-rh="true" name="twitter:image" content="https://services.rt.nyu.edu/img/NYU.svg"><meta data-rh="true" property="og:url" content="https://services.rt.nyu.edu/docs/hpc/ood/jupyter_with_conda_singularity/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Jupyter Notebook with Conda/Singularity in OOD | Connecting researchers to computational resources."><meta data-rh="true" name="description" content="Please note that Greene and Torch organize overlay files and Singularity images in different directories."><meta data-rh="true" property="og:description" content="Please note that Greene and Torch organize overlay files and Singularity images in different directories."><link data-rh="true" rel="icon" href="/img/NYU.ico"><link data-rh="true" rel="canonical" href="https://services.rt.nyu.edu/docs/hpc/ood/jupyter_with_conda_singularity/"><link data-rh="true" rel="alternate" href="https://services.rt.nyu.edu/docs/hpc/ood/jupyter_with_conda_singularity/" hreflang="en"><link data-rh="true" rel="alternate" href="https://services.rt.nyu.edu/docs/hpc/ood/jupyter_with_conda_singularity/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Jupyter Notebook with Conda/Singularity in OOD","item":"https://services.rt.nyu.edu/docs/hpc/ood/jupyter_with_conda_singularity"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Connecting researchers to computational resources. RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Connecting researchers to computational resources. Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2DXB3BDH70"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2DXB3BDH70",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.f829a653.css">
<script src="/assets/js/runtime~main.1423adea.js" defer="defer"></script>
<script src="/assets/js/main.1b6e9861.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/NYU.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_TUNJ" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/NYU.svg" alt="NYU torch logo" class="themedComponent_adik themedComponent--light_G91j"><img src="/img/NYU.svg" alt="NYU torch logo" class="themedComponent_adik themedComponent--dark_ZN7y"></div><b class="navbar__title text--truncate">Research Technology Services</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/genai/getting_started/intro/">Pythia</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/hpc/getting_started/intro/">HPC</a><a class="navbar__item navbar__link" href="/docs/cloud/getting_started/intro/">Cloud</a><a class="navbar__item navbar__link" href="/docs/srde/getting_started/intro/">SRDE</a><a href="https://hsrn.nyu.edu/docs/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">HSRN<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_NVDT"><use href="#theme-svg-external-link"></use></svg></a><a class="navbar__item navbar__link" href="/blog/">Announcements</a><div class="toggle_jqKN colorModeToggle_gY5u"><button class="clean-btn toggleButton_lieL toggleButtonDisabled_sjb2" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_AmaU lightToggleIcon_PUFc"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_AmaU darkToggleIcon_woI4"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_AmaU systemToggleIcon_QZRn"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_gKxF"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_necp"><div class="docsWrapper_wAz_"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_QBOB" type="button"></button><div class="docRoot_gn_g"><aside class="theme-doc-sidebar-container docSidebarContainer_RCWh"><div class="sidebarViewport_BocM"><div class="sidebar_w3s6"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_EeVB"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_HmkA menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/hpc/getting_started/intro/"><span title="Getting Started" class="categoryLinkLabel_vKI6">Getting Started</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_HmkA menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/hpc/connecting_to_hpc/connecting_to_hpc/"><span title="Setup" class="categoryLinkLabel_vKI6">Setup</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_HmkA menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/hpc/storage/intro_and_data_management/"><span title="Storage &amp; Data transfers" class="categoryLinkLabel_vKI6">Storage &amp; Data transfers</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_HmkA menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/hpc/datasets/intro/"><span title="Datasets" class="categoryLinkLabel_vKI6">Datasets</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_HmkA menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/hpc/submitting_jobs/slurm_submitting_jobs/"><span title="Submitting jobs" class="categoryLinkLabel_vKI6">Submitting jobs</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_HmkA menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/hpc/tools_and_software/intro/"><span title="Tools &amp; Software" class="categoryLinkLabel_vKI6">Tools &amp; Software</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_HmkA menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/hpc/containers/intro/"><span title="Containers" class="categoryLinkLabel_vKI6">Containers</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_HmkA menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/hpc/ml_ai_hpc/intro/"><span title="ML/AI on HPC" class="categoryLinkLabel_vKI6">ML/AI on HPC</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_HmkA menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/hpc/ood/ood_intro/"><span title="Open OnDemand (OOD)" class="categoryLinkLabel_vKI6">Open OnDemand (OOD)</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/hpc/ood/ood_intro/"><span title="Introduction to Open OnDemand (OOD)" class="linkLabel_BOGb">Introduction to Open OnDemand (OOD)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/hpc/ood/CellACDC/"><span title="Cell-ACDC in OOD" class="linkLabel_BOGb">Cell-ACDC in OOD</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/hpc/ood/Dask/"><span title="Dask in Jupyter Notebook in OOD" class="linkLabel_BOGb">Dask in Jupyter Notebook in OOD</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/hpc/ood/Desktop/"><span title="Desktop in OOD" class="linkLabel_BOGb">Desktop in OOD</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/hpc/ood/igv/"><span title="Integrative Genomics Viewer (IGV) in OOD" class="linkLabel_BOGb">Integrative Genomics Viewer (IGV) in OOD</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/hpc/ood/jbrowse_genome_browser/"><span title="JBrowse Genome Browser in OOD" class="linkLabel_BOGb">JBrowse Genome Browser in OOD</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/hpc/ood/jupyter_with_conda_singularity/"><span title="Jupyter Notebook with Conda/Singularity in OOD" class="linkLabel_BOGb">Jupyter Notebook with Conda/Singularity in OOD</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/hpc/ood/matlab_proxy/"><span title="Matlab-Proxy in OOD" class="linkLabel_BOGb">Matlab-Proxy in OOD</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/hpc/ood/RStudio/"><span title="RStudio in OOD" class="linkLabel_BOGb">RStudio in OOD</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/hpc/ood/Spark/"><span title="Spark Standalone Cluster with Jupyter Notebook in OOD" class="linkLabel_BOGb">Spark Standalone Cluster with Jupyter Notebook in OOD</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/hpc/ood/Stata/"><span title="Stata in OOD" class="linkLabel_BOGb">Stata in OOD</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/hpc/spec_sheet/"><span title="Torch Spec Sheet" class="linkLabel_BOGb">Torch Spec Sheet</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/hpc/system_status/"><span title="Greene System Status" class="linkLabel_BOGb">Greene System Status</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_HmkA menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/hpc/tutorial_intro_shell_hpc/intro/"><span title="Tutorial: Intro to Shell for HPC" class="categoryLinkLabel_vKI6">Tutorial: Intro to Shell for HPC</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_HmkA menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/hpc/tutorial_intro_hpc/intro_hpc/"><span title="Tutorial: Intro to HPC" class="categoryLinkLabel_vKI6">Tutorial: Intro to HPC</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_HmkA menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/hpc/support/support/"><span title="Support" class="categoryLinkLabel_vKI6">Support</span></a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_M8Os"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_dZwW"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_cg7U"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_l9oI"><div class="docItemContainer_ENRc"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_N0Nx" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_CnUo"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Open OnDemand (OOD)</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Jupyter Notebook with Conda/Singularity in OOD</span></li></ul></nav><div class="tocCollapsible_lcDd theme-doc-toc-mobile tocMobile_o_ql"><button type="button" class="clean-btn tocCollapsibleButton_A397">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Jupyter Notebook with Conda/Singularity in OOD</h1></header>
<p>Please note that Greene and Torch organize overlay files and Singularity images in different directories.</p>
<h2 class="anchor anchorTargetStickyNavbar_wKjT" id="greene-directories">Greene Directories<a href="#greene-directories" class="hash-link" aria-label="Direct link to Greene Directories" title="Direct link to Greene Directories" translate="no">​</a></h2>
<p>Overlay Files:</p>
<div class="language-text codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-text codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">/scratch/work/public/overlay-fs-ext3/</span><br></span></code></pre></div></div>
<p>Singularity Files:</p>
<div class="language-text codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-text codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">/scratch/work/public/singularity/</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_wKjT" id="torch-directories">Torch Directories<a href="#torch-directories" class="hash-link" aria-label="Direct link to Torch Directories" title="Direct link to Torch Directories" translate="no">​</a></h2>
<p>Overlay Files:</p>
<div class="language-text codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-text codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">/share/apps/overlay-fs-ext3</span><br></span></code></pre></div></div>
<p>Singularity Files:</p>
<div class="language-text codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-text codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">/share/apps/images/</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_wKjT" id="ood--singularity--conda">OOD + Singularity + conda<a href="#ood--singularity--conda" class="hash-link" aria-label="Direct link to OOD + Singularity + conda" title="Direct link to OOD + Singularity + conda" translate="no">​</a></h2>
<p>This page describes how to use your Singularity with conda environment in OOD GUI at Torch.</p>
<h3 class="anchor anchorTargetStickyNavbar_wKjT" id="log-into-torch-via-the-terminal">Log Into Torch via the Terminal<a href="#log-into-torch-via-the-terminal" class="hash-link" aria-label="Direct link to Log Into Torch via the Terminal" title="Direct link to Log Into Torch via the Terminal" translate="no">​</a></h3>
<p>The following commands must be run from the terminal. Information on accessing via the terminal can be found at <a class="" href="/docs/hpc/connecting_to_hpc/connecting_to_hpc/">Connecting to the HPC</a> or you can log into OOD and select the <code>Clusters</code> tab at the top of the page and select <code>Torch Shell Access</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_wKjT" id="preinstallation-warning">Preinstallation Warning<a href="#preinstallation-warning" class="hash-link" aria-label="Direct link to Preinstallation Warning" title="Direct link to Preinstallation Warning" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-warning admonition_nT0D alert alert--warning"><div class="admonitionHeading_v1P0"><span class="admonitionIcon_Vpqq"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_kdNk"><p>If you have initialized Conda in your base environment, your prompt on Torch may show something like:</p><div class="language-bash codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-bash codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">base</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">NetID@log-1 ~</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">$</span><br></span></code></pre></div></div><p>then you must first comment out or remove this portion of your <code>~/.bashrc</code> file:</p><div class="language-bash codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-bash codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># &gt;&gt;&gt; conda initialize &gt;&gt;&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># !! Contents within this block are managed by &#x27;conda init&#x27; !!</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">__conda_setup</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">&#x27;/share/apps/anaconda3/2020.07/bin/conda</span><span class="token string variable string" style="color:hsl(119, 34%, 47%)">&#x27; &#x27;</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">shell.bash</span><span class="token string variable string" style="color:hsl(119, 34%, 47%)">&#x27; &#x27;</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">hook&#x27; </span><span class="token string variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> /dev/null</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$?</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-eq</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">eval</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$__conda_setup</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;/share/apps/anaconda3/2020.07/etc/profile.d/conda.sh&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;/share/apps/anaconda3/2020.07/etc/profile.d/conda.sh&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:hsl(35, 99%, 36%)">PATH</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;/share/apps/anaconda3/2020.07/bin:</span><span class="token string environment constant" style="color:hsl(35, 99%, 36%)">$PATH</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">unset</span><span class="token plain"> __conda_setup</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># &lt;&lt;&lt; conda initialize &lt;&lt;&lt;</span><br></span></code></pre></div></div><p>The above code automatically makes your environment look for the default shared installation of Conda on the cluster and will sabotage  any attempts to install packages to a Singularity environment. Once removed or commented out, log out and back into the cluster for a fresh environment.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_wKjT" id="prepare-overlay-file">Prepare Overlay File<a href="#prepare-overlay-file" class="hash-link" aria-label="Direct link to Prepare Overlay File" title="Direct link to Prepare Overlay File" translate="no">​</a></h3>
<p>First, start a job to work on the compute nodes.</p>
<div class="language-bash codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-bash codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">NetID@log-1 my_env</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">$ sbatch --cpus-per-task</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--mem</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">10GB </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--time</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">04:00:00 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--wrap</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;sleep infinity&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># wait to be assigned a node then SSH to the node</span><br></span></code></pre></div></div>
<p>Once you SSH to the node, you can begin setting up the environment.</p>
<div class="theme-admonition theme-admonition-note admonition_nT0D alert alert--secondary"><div class="admonitionHeading_v1P0"><span class="admonitionIcon_Vpqq"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Files will not properly compile on the login nodes as they have different Red Hat OS images than the compute nodes. All compilation and package installation must be done on the compute nodes.</div><div class="admonitionContent_kdNk"><div class="language-bash codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-bash codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">NetID@log-1 ~</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">$ </span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> /scratch/</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain">/my_env</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">NetID@log-1 ~</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">$ </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> /scratch/</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain">/my_env</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">NetID@log-1 my_env</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">$ </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rp</span><span class="token plain"> /share/apps/overlay-fs-ext3/overlay-15GB-500K.ext3.gz </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">NetID@log-1 my_env</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">$ gunzip overlay-15GB-500K.ext3.gz</span><br></span></code></pre></div></div><p>Above we used the overlay file <code>overlay-15GB-500K.ext3.gz</code> which will contain all of the installed packages. There are more optional overlay files. You can find instructions on the following pages: <a class="" href="/docs/hpc/containers/singularity_with_conda/">Singularity with Conda</a>, <a class="" href="/docs/hpc/containers/squash_file_system_and_singularity/">Squash File System and Singularity</a>.</p><h3 class="anchor anchorTargetStickyNavbar_wKjT" id="launch-singularity-environment-for-installation">Launch Singularity Environment for Installation<a href="#launch-singularity-environment-for-installation" class="hash-link" aria-label="Direct link to Launch Singularity Environment for Installation" title="Direct link to Launch Singularity Environment for Installation" translate="no">​</a></h3><div class="language-bash codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-bash codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">NetID@log-1 ~</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">$ singularity </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exec</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--fakeroot</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--overlay</span><span class="token plain"> /scratch/</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain">/my_env/overlay-15GB-500K.ext3:rw /share/apps/images/cuda12.3.2-cudnn9.0.0-ubuntu-22.04.4.sif /bin/bash</span><br></span></code></pre></div></div><p>Above we used the Singularity OS image <code>cuda12.3.2-cudnn9.0.0-ubuntu-22.04.4.sif</code> which provides the base operating system environment for the conda environment. There are other Singularity OS images available at <code>/share/apps/images</code></p><p>Launching Singularity with the <code>--overlay</code> flag mounts the overlay file to a new directory: <code>/ext3</code> - you will notice that when not using Singularity <code>/ext3</code> is not available.</p><div class="theme-admonition theme-admonition-warning admonition_nT0D alert alert--warning"><div class="admonitionHeading_v1P0"><span class="admonitionIcon_Vpqq"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_kdNk"><p>Be sure that you have the Singularity prompt (<code>Singularity&gt;</code>) and that <code>/ext3</code> is available before the next step.</p><div class="language-bash codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-bash codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-lah</span><span class="token plain"> /ext3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">total </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain">.5K</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">drwxrwxr-x.  </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"> root root </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.0K Oct </span><span class="token number" style="color:hsl(35, 99%, 36%)">19</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><span class="token plain">:01 </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">drwx------. </span><span class="token number" style="color:hsl(35, 99%, 36%)">29</span><span class="token plain"> root root </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain">.0K Oct </span><span class="token number" style="color:hsl(35, 99%, 36%)">19</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><span class="token plain">:01 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><br></span></code></pre></div></div></div></div></div></div>
<h3 class="anchor anchorTargetStickyNavbar_wKjT" id="install-miniforge-to-overlay-file">Install Miniforge to Overlay File<a href="#install-miniforge-to-overlay-file" class="hash-link" aria-label="Direct link to Install Miniforge to Overlay File" title="Direct link to Install Miniforge to Overlay File" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-bash codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> --no-check-certificate https://github.com/conda-forge/miniforge/releases/latest/download/Miniforge3-Linux-x86_64.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sh</span><span class="token plain"> Miniforge3-Linux-x86_64.sh </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-b</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> /ext3/miniforge3</span><br></span></code></pre></div></div>
<p>Next, create a wrapper script at <code>/ext3/env.sh</code>:</p>
<div class="language-bash codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-bash codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> /ext3/env.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;#!/bin/bash&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> /ext3/env.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;unset -f which&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> /ext3/env.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;source /ext3/miniforge3/etc/profile.d/conda.sh&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> /ext3/env.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;export PATH=/ext3/miniforge3/bin:$PATH&#x27;</span><span class="token plain">         </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> /ext3/env.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;export PYTHONPATH=/ext3/miniforge3/bin:$PATH&#x27;</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> /ext3/env.sh</span><br></span></code></pre></div></div>
<p>Your <code>/ext3/env.sh</code> file should now contain the following:</p>
<div class="language-bash codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-bash codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">unset</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">which</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">source</span><span class="token plain"> /ext3/miniforge3/etc/profile.d/conda.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:hsl(35, 99%, 36%)">PATH</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">/ext3/miniforge3/bin:</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$PATH</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PYTHONPATH</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">/ext3/miniforge3/bin:</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$PATH</span><br></span></code></pre></div></div>
<p>The wrapper script will activate your conda environment, to which you will be installing your packages and dependencies.</p>
<p>Next, activate your conda environment with the following:</p>
<div class="language-bash codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-bash codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">source</span><span class="token plain"> /ext3/env.sh</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_wKjT" id="install-packages-to-miniforge-environment">Install Packages to Miniforge Environment<a href="#install-packages-to-miniforge-environment" class="hash-link" aria-label="Direct link to Install Packages to Miniforge Environment" title="Direct link to Install Packages to Miniforge Environment" translate="no">​</a></h3>
<p>Now that your environment is activated, you can update and install packages:</p>
<div class="language-bash codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-bash codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> conda config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--remove</span><span class="token plain"> channels defaults</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> conda update </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> base conda </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-y</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> conda clean </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--all</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> conda </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> pip </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> conda </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> ipykernel </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--yes</span><span class="token plain"> </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Note: ipykernel is required to run as a kernel in the Open OnDemand Jupyter Notebooks</span><br></span></code></pre></div></div>
<p>To confirm that your environment is appropriately referencing your Miniforge installation, try out the following:</p>
<div class="language-bash codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-bash codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">unset</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">which</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">which</span><span class="token plain"> conda</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># output: /ext3/miniforge3/bin/conda</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">which</span><span class="token plain"> python</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># output: /ext3/miniforge3/bin/python</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> python </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># output: Python 3.12.9</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">which</span><span class="token plain"> pip</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># output: /ext3/miniforge3/bin/pip</span><br></span></code></pre></div></div>
<p>Now use either conda or pip to install your required python packages to the Miniforge environment.</p>
<div class="theme-admonition theme-admonition-note admonition_nT0D alert alert--secondary"><div class="admonitionHeading_v1P0"><span class="admonitionIcon_Vpqq"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>If using Apptainer (the default Singularity installation on Torch) be sure to use the --fakeroot flag when launching overlay files in read-write mode (<!-- -->:rw<!-- -->).</div><div class="admonitionContent_kdNk"><p>To install larger packages, like Tensorflow, you must first start an interactive job with adequate compute and memory resources to install packages. The login nodes restrict memory to 2GB per user, which may cause some large packages to crash.</p><div class="language-bash codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-bash codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exit</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">NetID@log-1 my_env</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">$ sbatch --cpus-per-task</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--mem</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">10GB </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--time</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">04:00:00 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--wrap</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;sleep infinity&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># wait to be assigned a node then SSH to the node</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">NetID@cm001 my_env</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">$ singularity </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exec</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--fakeroot</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--overlay</span><span class="token plain"> /scratch/</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain">/my_env/overlay-15GB-500K.ext3:rw /share/apps/images/cuda12.3.2-cudnn9.0.0-ubuntu-22.04.4.sif /bin/bash</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">source</span><span class="token plain"> /ext3/env.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># activate the environment</span><br></span></code></pre></div></div><p>After it is running, you’ll be redirected to a compute node. From there, run singularity to setup on conda environment, same as you were doing on login node.</p><h3 class="anchor anchorTargetStickyNavbar_wKjT" id="configure-ipython-kernels">Configure iPython Kernels<a href="#configure-ipython-kernels" class="hash-link" aria-label="Direct link to Configure iPython Kernels" title="Direct link to Configure iPython Kernels" translate="no">​</a></h3><p>To create a kernel named my_env copy the template files to your home directory.
Please note that kernel_template on Greene is stored under <code>/share/apps/mypy/src/kernel_template</code></p><div class="language-bash codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-bash codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ~/.local/share/jupyter/kernels</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> ~/.local/share/jupyter/kernels</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-R</span><span class="token plain"> /share/apps/kernel_template ./my_env </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># this should be the name of your Singularity env</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> ./my_env </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Singularity</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#kernel.json  logo-32x32.png  logo-64x64.png  python # files in the ~/.local/share/jupyter/kernels directory</span><br></span></code></pre></div></div><p>To set the conda environment, edit the file named <code>python</code> in <code>/.local/share/jupyter/kernels/my_env/</code>.</p><p>The python file is a wrapper script that the Jupyter notebook will use to launch your Singularity container and attach it to the notebook.</p><p>At the bottom of the file we have the template singularity command.</p><div class="language-bash codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-bash codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">singularity </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exec</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$nv</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--overlay</span><span class="token plain"> /scratch/</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain">/my_env/overlay-15GB-500K.ext3:ro </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  /share/apps/images/cuda12.3.2-cudnn9.0.0-ubuntu-22.04.4.sif </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  /bin/bash </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;source /ext3/env.sh; </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$cmd</span><span class="token string" style="color:hsl(119, 34%, 47%)"> </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$args</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><br></span></code></pre></div></div><div class="theme-admonition theme-admonition-warning admonition_nT0D alert alert--warning"><div class="admonitionHeading_v1P0"><span class="admonitionIcon_Vpqq"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_kdNk"><p>If you used a different overlay (/scratch/$USER/my_env/overlay-15GB-500K.ext3 shown above) or .sif file (/share/apps/images/cuda12.3.2-cudnn9.0.0-ubuntu-22.04.4.sif shown above), you MUST change those lines in the command above to the files you used.</p></div></div></div></div>
<p>Edit the default <code>kernel.json</code> file by setting PYTHON_LOCATION and KERNEL_DISPLAY_NAME using a text editor like nano/vim.</p>
<div class="language-json codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-json codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> </span><span class="token property" style="color:hsl(5, 74%, 59%)">&quot;argv&quot;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;PYTHON_LOCATION&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;-m&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;ipykernel_launcher&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;-f&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;{connection_file}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> </span><span class="token property" style="color:hsl(5, 74%, 59%)">&quot;display_name&quot;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;KERNEL_DISPLAY_NAME&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> </span><span class="token property" style="color:hsl(5, 74%, 59%)">&quot;language&quot;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;python&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>to</p>
<div class="language-json codeBlockContainer_ndbq theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_Zo7j"><pre tabindex="0" class="prism-code language-json codeBlock_hgHP thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_EpfB"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> </span><span class="token property" style="color:hsl(5, 74%, 59%)">&quot;argv&quot;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;/home/&lt;Your NetID&gt;/.local/share/jupyter/kernels/my_env/python&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;-m&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;ipykernel_launcher&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;-f&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;{connection_file}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> </span><span class="token property" style="color:hsl(5, 74%, 59%)">&quot;display_name&quot;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;my_env&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> </span><span class="token property" style="color:hsl(5, 74%, 59%)">&quot;language&quot;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;python&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>Update the <code>&quot;&lt;Your NetID&gt;&quot;</code> to your own NetID without the <code>&quot;&lt;&gt;&quot;</code> symbols.</p>
<h3 class="anchor anchorTargetStickyNavbar_wKjT" id="launch-an-ood-jupyter-notebook">Launch an OOD Jupyter Notebook<a href="#launch-an-ood-jupyter-notebook" class="hash-link" aria-label="Direct link to Launch an OOD Jupyter Notebook" title="Direct link to Launch an OOD Jupyter Notebook" translate="no">​</a></h3>
<p>Go to <a href="https://ood.torch.hpc.nyu.edu" target="_blank" rel="noopener noreferrer" class="">https://ood.torch.hpc.nyu.edu</a> <br>
and select Jupyter Notebook from the Interactive Apps pull-down menu:</p>
<p><img decoding="async" loading="lazy" alt="OOD Launch" src="/assets/images/start_jupyter-cd1b88605a808d7e3d1847762f4b4c5c.png" width="808" height="675" class="img_XaWr"></p>
<h3 class="anchor anchorTargetStickyNavbar_wKjT" id="configure-and-launch-your-notebook">Configure and Launch your Notebook<a href="#configure-and-launch-your-notebook" class="hash-link" aria-label="Direct link to Configure and Launch your Notebook" title="Direct link to Configure and Launch your Notebook" translate="no">​</a></h3>
<p><img decoding="async" loading="lazy" alt="Configure Notebook" src="/assets/images/configure_notebook-cbb0519d367e164591f44822fcfe0f79.png" width="901" height="1168" class="img_XaWr"></p>
<h3 class="anchor anchorTargetStickyNavbar_wKjT" id="select-kernel">Select kernel<a href="#select-kernel" class="hash-link" aria-label="Direct link to Select kernel" title="Direct link to Select kernel" translate="no">​</a></h3>
<p>Once configured and launched, kernels can be selected in the &quot;New&quot; dropdown or within the notebook under the kernel menu. Please note that your notebook view may look slightly different depending on available directories and environments, as well as if you choose the lab or traditional notebook view.</p>
<p><img decoding="async" loading="lazy" alt="Select Kernel" src="/assets/images/select_kernel-7e551016b02a751f51275d0fad706d43.png" width="1280" height="884" class="img_XaWr"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_AAw7"><a href="https://github.com/NYU-RTS/rts-docs/blob/main/docs/hpc/09_ood/07_jupyter_with_conda_singularity.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_OZ0G" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_RgrK"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/hpc/ood/jbrowse_genome_browser/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">JBrowse Genome Browser in OOD</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/hpc/ood/matlab_proxy/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Matlab-Proxy in OOD</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_Py9d thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#greene-directories" class="table-of-contents__link toc-highlight">Greene Directories</a></li><li><a href="#torch-directories" class="table-of-contents__link toc-highlight">Torch Directories</a></li><li><a href="#ood--singularity--conda" class="table-of-contents__link toc-highlight">OOD + Singularity + conda</a><ul><li><a href="#log-into-torch-via-the-terminal" class="table-of-contents__link toc-highlight">Log Into Torch via the Terminal</a></li><li><a href="#preinstallation-warning" class="table-of-contents__link toc-highlight">Preinstallation Warning</a></li><li><a href="#prepare-overlay-file" class="table-of-contents__link toc-highlight">Prepare Overlay File</a></li><li><a href="#launch-singularity-environment-for-installation" class="table-of-contents__link toc-highlight">Launch Singularity Environment for Installation</a></li><li><a href="#install-miniforge-to-overlay-file" class="table-of-contents__link toc-highlight">Install Miniforge to Overlay File</a></li><li><a href="#install-packages-to-miniforge-environment" class="table-of-contents__link toc-highlight">Install Packages to Miniforge Environment</a></li><li><a href="#configure-ipython-kernels" class="table-of-contents__link toc-highlight">Configure iPython Kernels</a></li><li><a href="#launch-an-ood-jupyter-notebook" class="table-of-contents__link toc-highlight">Launch an OOD Jupyter Notebook</a></li><li><a href="#configure-and-launch-your-notebook" class="table-of-contents__link toc-highlight">Configure and Launch your Notebook</a></li><li><a href="#select-kernel" class="table-of-contents__link toc-highlight">Select kernel</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Contact</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:hpc@nyu.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email HPC support<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_NVDT"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:hsrn-support@nyu.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email HSRN support<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_NVDT"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:research-cloud-support@nyu.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email Research Cloud support<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_NVDT"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:srde-support@nyu.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email Secure Research Data Environment support<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_NVDT"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:genai-support@nyu.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email general GenAI support<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_NVDT"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:genai-research-support@nyu.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email GenAI for research support<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_NVDT"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://guides.nyu.edu/" target="_blank" rel="noopener noreferrer" class="footer__link-item">NYU Libraries Research Guides<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_NVDT"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://sites.google.com/nyu.edu/forc-camp/home" target="_blank" rel="noopener noreferrer" class="footer__link-item">FORC camp<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_NVDT"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docs.google.com/forms/d/e/1FAIpQLSeHnmkPdR_IvWnT6a7U_V3RpfmQrpS8hjxI11FNnsZMlrBa4g/viewform" target="_blank" rel="noopener noreferrer" class="footer__link-item">Feedback</a></li><li class="footer__item"><a class="footer__link-item" href="/blog/">Announcements</a></li><li class="footer__item"><a href="https://github.com/NYU-RTS/rts-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_NVDT"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Made with 💜 in NYC!</div></div></div></footer></div>
</body>
</html>